{"version":3,"sources":["../src/renderer.js"],"names":["LEFT_EDGE","RIGHT_EDGE","TOP_EDGE","BOTTOM_EDGE","HORIZONTAL_OFFSET","MANDEL_RATIO","MIMETYPE_PNG","DEFAULT_SETTINGS","coloringMethod","loopPalette","filters","palette","r","g","b","Renderer","canvas","options","_options","Object","assign","_canvas","_context","getContext","_imageData","createImageData","width","height","_data","data","_coloringMethod","_sampler","julia","updateViewportSize","_scale","_dx","_dy","val","toDataURL","x","y","color","dataIndex","length","_imageRatio","ratio","product","_topEdge","_bottomEdge","_leftEdge","_rightEdge","xMax","xMin","yMax","yMin","xStep","yStep","realPositionToComplexPosition","i","sample","plot","scale","dx0","dy0","updateRealBoundaries","sampleCoordinate","paint","putImageData","parseInt"],"mappings":"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","sourcesContent":["import coloringMethod from './coloring-method';\nimport {\n  julia\n} from './samplers/julia';\n\n//the bounds of the set\nconst LEFT_EDGE = -2.5;\nconst RIGHT_EDGE = 1;\nconst TOP_EDGE = -1;\nconst BOTTOM_EDGE = 1;\n\n//because the bounds of the set are uneven, we're horizontally offset this much\nconst HORIZONTAL_OFFSET = LEFT_EDGE - ((LEFT_EDGE - RIGHT_EDGE) / 2);\n\n//width / height ratio of the bounds of the set\nconst MANDEL_RATIO = (RIGHT_EDGE - LEFT_EDGE) / (BOTTOM_EDGE - TOP_EDGE);\n\nconst MIMETYPE_PNG = 'image/png';\n\n\nconst DEFAULT_SETTINGS = {\n  coloringMethod: 'default',\n  loopPalette: false,\n  filters: 'none',\n  palette: [{r:0, g:0, b:0}, {r:255, g:255, b:255}],\n};\n\nclass Renderer {\n  constructor(canvas, options) {\n\n    this._options = Object.assign({}, DEFAULT_SETTINGS, options);\n\n    this._canvas = canvas;\n    this._context = this._canvas.getContext('2d');\n    this._imageData = this._context.createImageData(this._canvas.width, this._canvas.height);\n    this._data = this._imageData.data;\n\n    this._coloringMethod = coloringMethod[this._options.coloringMethod];\n    this._sampler = julia;\n\n    this.updateViewportSize();\n\n    this._scale = 1;\n    this._dx = HORIZONTAL_OFFSET;\n    this._dy = 0;\n  }\n\n  get palette() {\n    return this._options.palette;\n  }\n\n  set palette(val){\n    this._options.palette= val;\n  }\n\n  get DataUrl() {\n    return this._canvas.toDataURL(MIMETYPE_PNG);\n  }\n\n  plot(x, y, color) {\n    //the canvas pixel data is a bit awkward to get at...\n    //see: https://www.w3.org/TR/2dcontext/#pixel-manipulation\n    var dataIndex = (y * this._imageData.width + x) * 4;\n    if (dataIndex < this._data.length && dataIndex >= 0) {\n      this._data[dataIndex] = color.r;\n      this._data[dataIndex + 1] = color.g;\n      this._data[dataIndex + 2] = color.b;\n      this._data[dataIndex + 3] = 255; //max saturation\n    }\n  }\n\n  updateViewportSize() {\n    //width / height ratio of the viewport\n    this._imageData = this._context.createImageData(this._canvas.width, this._canvas.height);\n    this._data = this._imageData.data;\n    this._imageRatio = this._imageData.width / this._imageData.height;\n\n    var ratio = 1;\n    var product = 0;\n\n    this._topEdge = TOP_EDGE;\n    this._bottomEdge = BOTTOM_EDGE;\n    this._leftEdge = LEFT_EDGE;\n    this._rightEdge = RIGHT_EDGE;\n\n    //modify the bounds we display based on the\n    //difference between the viewport ratio and\n    //the ratio of the bounds of the mandelbrot\n    if (this._imageRatio > MANDEL_RATIO) {\n      ratio = (this._imageRatio / MANDEL_RATIO);\n      product = (RIGHT_EDGE - LEFT_EDGE) * ratio;\n\n      this._leftEdge = -product * (2.5 / 3.5);\n      this._rightEdge = product * (1 / 3.5);\n    } else {\n      ratio = (MANDEL_RATIO / this._imageRatio);\n      product = (BOTTOM_EDGE - TOP_EDGE) * ratio;\n\n      this._topEdge = -product / 2.0;\n      this._bottomEdge = product / 2.0;\n    }\n  }\n\n  updateRealBoundaries() {\n    //the Real (ℝ) boundaries of the rendering given the zoom and offset\n    this.xMax = this._rightEdge / this._scale + this._dx;\n    this.xMin = this._leftEdge / this._scale + this._dx;\n    this.yMax = this._bottomEdge / this._scale + this._dy;\n    this.yMin = this._topEdge / this._scale + this._dy;\n\n    //translation of \"Pixel space\" to Real (ℝ) space\n    //i.e., these variables represent the Real difference\n    //between two pixels, horizonatally and vertically\n    this.xStep = (this.xMax - this.xMin) / this._imageData.width;\n    this.yStep = (this.yMax - this.yMin) / this._imageData.height;\n  }\n\n  sampleCoordinate(x, y){\n    //scale the pixel values to be within the bounds of the set\n    let {\n      r,\n      i\n    } = this.realPositionToComplexPosition(x, y);\n\n    //TODO: if the coloring method or palette has changed without the coordinates,\n    //zoom, or viewFrame changing, we can simply re-color the samples we already took\n    let sample = this._sampler(0,0,r,i);\n\n    return sample;\n  }\n\n  paint(x, y, sample){\n    let color = this._coloringMethod(sample, this._options);\n    this.plot(x, y, color);\n  }\n\n  //scale: how far we've zoomed in from the default\n  //dx0: displacement of perspective horizontally\n  //dy0: displacement of perspective vertically\n  async render(scale, dx0, dy0) {\n    this._scale = scale;\n\n    this._dx = dx0 - (HORIZONTAL_OFFSET / this._scale);\n    this._dy = dy0;\n\n    this.updateRealBoundaries();\n\n    for (var y = 0; y < this._imageData.height; y++) {\n      for (var x = 0; x < this._imageData.width; x++) {\n        let sample = this.sampleCoordinate(x,y);\n        this.paint(x, y, sample);\n      }\n    }\n\n\n    //TODO: the below is for applying filters to the image\n    // this._context.filter = 'blur(5px)';\n    // let tempCanvas = document.createElement('canvas');\n    // let tempContext = tempCanvas.getContext('2d');\n    // tempCanvas.width = this._canvas.width;\n    // tempCanvas.height = this._canvas.height;\n    // tempContext.putImageData(this._imageData, 0, 0);\n\n    // //draw it!\n    // this._context.drawImage(tempCanvas, 0, 0);\n\n    this._context.putImageData(this._imageData, 0, 0);\n  }\n\n  //r= the real part of the number\n  //i= the imaginary part of the number\n  complexPositionToRealPosition(r, i) {\n    return {\n      x: parseInt((r - this.xMin) / this.xStep),\n      y: parseInt((i - this.yMin) / this.yStep)\n    };\n  }\n\n  realPositionToComplexPosition(x, y) {\n    //scale the pixel values to frame the bounds of the set\n    return {\n      r: this.xMin + this.xStep * x,\n      i: this.yMin + this.yStep * y\n    };\n  }\n}\n\nexport default Renderer;\n"],"file":"renderer.js"}
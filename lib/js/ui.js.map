{"version":3,"sources":["../../src/js/ui.js"],"names":["Renderer","html","UNIT_PERCENT","UNIT_PX","UNIT_DEG","UNIT_RAD","UNIT_TURN","FILTERS","url","blur","val","unit","brightness","contrast","grayscale","invert","opacity","saturate","sepia","none","_renderScene","r","viewData","render","scale","x","y","_renderControls","ui","savedLocations","map","l","i","name","mandelog","UI","constructor","canvas","controls","_canvas","Node","document","getElementById","_controls","_r","coloringMethod","palette","_initViewData","_scale","_dx","_dy","canvasWidth","width","canvasHeight","height","_viewHistory","_viewData","Object","assign","savedData","window","localStorage","getItem","savedJSON","JSON","parse","Array","resizeCanvas","timestamp","concat","updateViewportSize","requestAnimationFrame","addEventListener","e","preventDefault","pos","realPositionToComplexPosition","layerX","layerY","zoomIn","zoomOut","msg","push","Date","reset","saveLocation","saveData","length","setItem","stringify","innerHTML","load","bindControls","getElementsByClassName","each","index","target","getAttribute","loc","console","log","module","exports"],"mappings":"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","file":"ui.js","sourcesContent":["import Renderer from '../graphics/renderer';\nimport {\n  html\n} from 'common-tags';\n\n\nconst UNIT_PERCENT = '%';\nconst UNIT_PX = 'px';\nconst UNIT_DEG = 'deg';\nconst UNIT_RAD = 'rad';\nconst UNIT_TURN = 'turn';\n\nconst FILTERS = {\n  url: '',\n  blur: {\n    val: 0,\n    unit: UNIT_PX\n  },\n  brightness: {\n    val: 100,\n    unit: UNIT_PERCENT\n  },\n  contrast: {\n    val: 100,\n    unit: UNIT_PERCENT\n  },\n  //'drop-shadow': {} // TODO: ugh\n  grayscale: {\n    val: 0,\n    unit: UNIT_PERCENT\n  },\n  'hue-rotate': {\n    val: 0,\n    unit: UNIT_DEG\n  },\n  invert: {\n    val: 0,\n    unit: UNIT_PERCENT\n  },\n  opacity: {\n    val: 100,\n    unit: UNIT_PERCENT\n  },\n  saturate: {\n    val: 100,\n    unit: UNIT_PERCENT\n  },\n  sepia: {\n    val: 0,\n    unit: UNIT_PERCENT\n  },\n  none: 'none'\n};\n\nfunction _renderScene(r, viewData) {\n  r.render(viewData.scale, viewData.x, viewData.y);\n}\n\nfunction _renderControls(ui, viewData) {\n  return html `\n        <div>\n            <a id=\"get-png\" href=\"#\" target=\"_blank\">GET PNG</a>\n        </div>\n        <div>\n            <button onclick=\"zoomIn();\">+</button>\n            <button onclick=\"zoomOut();\">-</button>\n            <button onclick=\"reset();\">Reset</button>\n        </div>\n        <div>\n            <button onclick=\"save();\">Save</button>\n        </div>\n        <div id=\"location\">\n            <div>\n                <label for=\"scale\">Scale</label>\n                <input id=\"scale\" type=\"text\" value=\"${viewData.scale}\"  />\n            </div>\n            <div>\n                <label for=\"x-location\">X</label>\n                <input id=\"x-location\" type=\"text\" value=\"${viewData.x}\" />\n            </div>\n            <div>\n                <label for=\"y-location\">Y</label>\n                <input id=\"y-location\" type=\"text\" value=\"${viewData.y}\" />\n            </div>\n            <button onclick=\"setLocation();\">go</button>\n        </div>\n        <div id=\"saved-list\">${viewData.savedLocations.map((l, i)=>{\n            return html `\n                <div>\n                    <a href=\"#\" class=\"saved-location\" data-location-index=\"${i}\">${l.name}}\n                </div>\n            `;\n        })}</div>\n        <div id=\"mandelog\">${viewData.mandelog.map((l, i)=>{\n            return html `<p>${i}: ${l}</p>`;\n        })}</div>\n    `;\n}\n\nclass UI {\n  constructor(canvas, controls) {\n    this._canvas = canvas instanceof Node ? canvas : document.getElementById(canvas);\n    this._controls = controls instanceof Node ? controls : document.getElementById(controls);\n\n    this._r = new Renderer(this._canvas, {\n      coloringMethod: 'continuous-coloring',\n      //palette: 'material-design-rainbow-a400',\n      palette: 'hue-shift-rainbow-chocolate',\n      //loopPalette: true\n    });\n\n    this._initViewData = {\n      scale: this._r._scale,\n      x: this._r._dx, //horizontal offset, used for centering the set\n      y: this._r._dy,\n      canvasWidth: this._canvas.width,\n      canvasHeight: this._canvas.height,\n      savedLocations: [],\n      mandelog: []\n    };\n\n    this._viewHistory = [this._initViewData];\n    this._viewData = Object.assign({}, this._initViewData);\n\n    var savedData = window.localStorage.getItem('locations');\n    if (savedData) {\n      var savedJSON = JSON.parse(savedData);\n      if (savedJSON instanceof Array) {\n        this._viewData.savedLocations = savedJSON;\n      }\n    }\n\n\n    let ui = this;\n    var resizeCanvas = (timestamp) => {\n      if (ui._viewHistory[0].canvasWidth !== ui._canvas.width || ui._viewHistory[0].canvasHeight !== ui._canvas.height) {\n        ui.mandelog(`viewport size changed`);\n        ui._viewHistory = [Object.assign({}, ui._viewData)].concat(ui._viewHistory);\n        ui._r.updateViewportSize();\n        Object.assign(ui._viewData, {\n          canvasWidth: this._canvas.width,\n          canvasHeight: this._canvas.height\n        });\n        ui.render();\n      }\n      window.requestAnimationFrame(resizeCanvas);\n    };\n    window.requestAnimationFrame(resizeCanvas);\n\n    this._canvas.addEventListener('click', function (e) {\n      e.preventDefault();\n      var pos = ui._r.realPositionToComplexPosition(e.layerX, e.layerY);\n      ui._viewData.x = pos.x;\n      ui._viewData.y = pos.y;\n      ui.zoomIn();\n    });\n  }\n\n  zoomIn() {\n    this._viewData.scale *= 2;\n    this.render();\n  }\n\n  zoomOut() {\n    this._viewData.scale /= 2;\n    this.render();\n  }\n  render() {\n    //_renderControls(this, this._viewData);\n    _renderScene(this._r, this._viewData);\n  }\n  //log to the UI's console\n  mandelog(msg) {\n    this._viewData.mandelog.push(`${+new Date()} ${msg}.`);\n  }\n  reset() {\n    Object.assign(this._viewData, {\n      scale: this._initViewData.scale,\n      x: this._initViewData.x,\n      y: this._initViewData.y\n    });\n    this.render();\n  }\n\n  saveLocation() {\n    var saveData = {};\n    saveData.name = 'location ' + (this._viewData.savedLocations.length + 1);\n    saveData.x = this._viewData.x;\n    saveData.y = this._viewData.y;\n    saveData.scale = this._viewData.scale;\n    this._viewData.savedLocations.push(saveData);\n    window.localStorage.setItem('locations', JSON.stringify(this._viewData.savedLocations));\n    this._controls.innerHTML = _renderControls(this, this._viewData);\n  }\n\n  load(l) {\n    Object.assign(this._viewData, l);\n    this.render();\n  }\n  bindControls() {\n    this._controls.getElementsByClassName('saved-location').each(function (i) {\n      i.addEventListener('click', e => {\n        e.preventDefault();\n        var index = e.target.getAttribute('data-location-index');\n        var loc = this._viewData.savedLocations[index];\n        console.log(loc);\n        //load(loc);\n      });\n    });\n  }\n}\n\nmodule.exports = UI;\n\n//TODO: update canvas compositor to a proper ES6 module, and use it for more interactivity\n"]}
{"version":3,"sources":["../src/ui.js"],"names":["UNIT_PERCENT","UNIT_PX","UNIT_DEG","UNIT_RAD","UNIT_TURN","FILTERS","url","blur","val","unit","brightness","contrast","grayscale","invert","opacity","saturate","sepia","none","_renderScene","r","viewData","render","scale","x","y","_renderControls","ui","savedLocations","map","l","i","name","log","UI","canvas","controls","_canvas","Node","document","getElementById","_controls","_r","Renderer","coloringMethod","palette","_initViewData","_scale","_dx","_dy","canvasWidth","width","canvasHeight","height","_viewHistory","_viewData","Object","assign","savedData","window","localStorage","getItem","savedJSON","JSON","parse","Array","resizeCanvas","concat","updateViewportSize","requestAnimationFrame","addEventListener","e","preventDefault","realPositionToComplexPosition","layerX","layerY","zoomIn","msg","push","Date","saveData","length","setItem","stringify","innerHTML","getElementsByClassName","each","index","target","getAttribute","loc","console","module","exports"],"mappings":"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","sourcesContent":["import Renderer from './renderer';\n\n\nconst UNIT_PERCENT = '%';\nconst UNIT_PX = 'px';\nconst UNIT_DEG = 'deg';\nconst UNIT_RAD = 'rad';\nconst UNIT_TURN = 'turn';\n\nconst FILTERS = {\n  url: '',\n  blur: {\n    val: 0,\n    unit: UNIT_PX\n  },\n  brightness: {\n    val: 100,\n    unit: UNIT_PERCENT\n  },\n  contrast: {\n    val: 100,\n    unit: UNIT_PERCENT\n  },\n  //'drop-shadow': {} // TODO: ugh\n  grayscale: {\n    val: 0,\n    unit: UNIT_PERCENT\n  },\n  'hue-rotate': {\n    val: 0,\n    unit: UNIT_DEG\n  },\n  invert: {\n    val: 0,\n    unit: UNIT_PERCENT\n  },\n  opacity: {\n    val: 100,\n    unit: UNIT_PERCENT\n  },\n  saturate: {\n    val: 100,\n    unit: UNIT_PERCENT\n  },\n  sepia: {\n    val: 0,\n    unit: UNIT_PERCENT\n  },\n  none: 'none'\n};\n\nfunction _renderScene(r, viewData) {\n  r.render(viewData.scale, viewData.x, viewData.y);\n}\n\nfunction _renderControls(ui, viewData) {\n  return `\n        <div>\n            <a id=\"get-png\" href=\"#\" target=\"_blank\">GET PNG</a>\n        </div>\n        <div>\n            <button onclick=\"zoomIn();\">+</button>\n            <button onclick=\"zoomOut();\">-</button>\n            <button onclick=\"reset();\">Reset</button>\n        </div>\n        <div>\n            <button onclick=\"save();\">Save</button>\n        </div>\n        <div id=\"location\">\n            <div>\n                <label for=\"scale\">Scale</label>\n                <input id=\"scale\" type=\"text\" value=\"${viewData.scale}\"  />\n            </div>\n            <div>\n                <label for=\"x-location\">X</label>\n                <input id=\"x-location\" type=\"text\" value=\"${viewData.x}\" />\n            </div>\n            <div>\n                <label for=\"y-location\">Y</label>\n                <input id=\"y-location\" type=\"text\" value=\"${viewData.y}\" />\n            </div>\n            <button onclick=\"setLocation();\">go</button>\n        </div>\n        <div id=\"saved-list\">${viewData.savedLocations.map((l, i)=>{ return  `\n                <div>\n                    <a href=\"#\" class=\"saved-location\" data-location-index=\"${i}\">${l.name}}\n                </div>\n            `;})}</div>\n        <div id=\"log\">\n          ${viewData.log.map((l, i)=>{ return  `<p>${i}: ${l}</p>`;})}\n        </div>\n    `;\n}\n\nclass UI {\n  constructor(canvas, controls) {\n    this._canvas = canvas instanceof Node ? canvas : document.getElementById(canvas);\n    this._controls = controls instanceof Node ? controls : document.getElementById(controls);\n\n    this._r = new Renderer(this._canvas, {\n      //coloringMethod: 'default',\n      coloringMethod: 'continuous-coloring',\n      //palette: 'material-design-rainbow-a400',\n      palette: 'default',\n      //loopPalette: true\n    });\n\n    this._initViewData = {\n      scale: this._r._scale,\n      x: this._r._dx, //horizontal offset, used for centering the set\n      y: this._r._dy,\n      canvasWidth: this._canvas.width,\n      canvasHeight: this._canvas.height,\n      savedLocations: [],\n      log: []\n    };\n\n    this._viewHistory = [this._initViewData];\n    this._viewData = Object.assign({}, this._initViewData);\n\n    var savedData = window.localStorage.getItem('locations');\n    if (savedData) {\n      var savedJSON = JSON.parse(savedData);\n      if (savedJSON instanceof Array) {\n        this._viewData.savedLocations = savedJSON;\n      }\n    }\n\n\n    let ui = this;\n    var resizeCanvas = () => {\n      if (ui._viewHistory[0].canvasWidth !== ui._canvas.width || ui._viewHistory[0].canvasHeight !== ui._canvas.height) {\n        ui.log(`viewport size changed`);\n        ui._viewHistory = [Object.assign({}, ui._viewData)].concat(ui._viewHistory);\n        ui._r.updateViewportSize();\n        Object.assign(ui._viewData, {\n          canvasWidth: this._canvas.width,\n          canvasHeight: this._canvas.height\n        });\n        ui.render();\n      }\n      window.requestAnimationFrame(resizeCanvas);\n    };\n    window.requestAnimationFrame(resizeCanvas);\n\n    this._canvas.addEventListener('click', function (e) {\n      e.preventDefault();\n      let {\n        r,\n        i\n      } = ui._r.realPositionToComplexPosition(e.layerX, e.layerY);\n      ui._viewData.x = r;\n      ui._viewData.y = i;\n      ui.zoomIn();\n    });\n  }\n\n  zoomIn() {\n    this._viewData.scale *= 2;\n    this.render();\n  }\n\n  zoomOut() {\n    this._viewData.scale /= 2;\n    this.render();\n  }\n  render() {\n    //_renderControls(this, this._viewData);\n    _renderScene(this._r, this._viewData);\n  }\n\n  //log to the UI's console\n  log(msg) {\n    this._viewData.log.push(`${+new Date()} ${msg}.`);\n  }\n\n  reset() {\n    Object.assign(this._viewData, {\n      scale: this._initViewData.scale,\n      x: this._initViewData.x,\n      y: this._initViewData.y\n    });\n    this.render();\n  }\n\n  saveLocation() {\n    var saveData = {};\n    saveData.name = 'location ' + (this._viewData.savedLocations.length + 1);\n    saveData.x = this._viewData.x;\n    saveData.y = this._viewData.y;\n    saveData.scale = this._viewData.scale;\n    this._viewData.savedLocations.push(saveData);\n    window.localStorage.setItem('locations', JSON.stringify(this._viewData.savedLocations));\n    this._controls.innerHTML = _renderControls(this, this._viewData);\n  }\n\n  load(l) {\n    Object.assign(this._viewData, l);\n    this.render();\n  }\n  bindControls() {\n    this._controls.getElementsByClassName('saved-location').each(function (i) {\n      i.addEventListener('click', e => {\n        e.preventDefault();\n        var index = e.target.getAttribute('data-location-index');\n        var loc = this._viewData.savedLocations[index];\n        console.log(loc);\n        //load(loc);\n      });\n    });\n  }\n}\n\nmodule.exports = UI;\n\n//TODO: update canvas compositor to a proper ES6 module, and use it for more interactivity\n"],"file":"ui.js"}
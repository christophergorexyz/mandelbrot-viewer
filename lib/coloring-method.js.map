{"version":3,"file":"coloring-method.js","names":["DEFAULT_SETTINGS","mandelbrotColor","r","g","b","loopPalette","palette","length","concat","slice","reverse","_escapeTime","sample","options","Object","assign","_palette","color","escaped","Math","floor","iterations","_interpolateValue","val1","val2","fraction","_interpolateColor","color1","color2","_continuousColoring","log_zn","log","orbitDistance","nu"],"sources":["../src/coloring-method.js"],"sourcesContent":["const DEFAULT_SETTINGS = {\n  mandelbrotColor: {\n    r: 0,\n    g: 0,\n    b: 0\n  },\n  loopPalette: false\n};\n\nfunction loopPalette(palette) {\n  if (palette.length > 2) {\n    return palette.concat(palette.slice(1, palette.length - 1).reverse());\n  }\n  return palette;\n}\n\n//An implementation of the Escape Time Algorithm with continuous coloring\n//almost directly from https://en.wikipedia.org/wiki/Mandelbrot_set#Escape_time_algorithm\n//with https://en.wikipedia.org/wiki/Mandelbrot_set#Continuous_.28smooth.29_coloring\nfunction _escapeTime(sample, options) {\n  options = Object.assign({}, DEFAULT_SETTINGS, options);\n  let _palette = options.loopPalette ? loopPalette(options.palette) : options.palette;\n\n  //deafult to black unless we managed to rule this pixel out\n  let color = options.mandelbrotColor;\n\n  if (sample.escaped) {\n    color = _palette[Math.floor(sample.iterations % _palette.length)];\n  }\n\n  return color;\n}\n\nfunction _interpolateValue(val1, val2, fraction) {\n  return (1 - fraction) * val1 + fraction * val2;\n}\n\nfunction _interpolateColor(color1, color2, fraction) {\n  return {\n    r: _interpolateValue(color1.r, color2.r, fraction),\n    g: _interpolateValue(color1.g, color2.g, fraction),\n    b: _interpolateValue(color1.b, color2.b, fraction),\n  };\n}\n\nfunction _continuousColoring(sample, options) {\n\n  options = Object.assign({}, DEFAULT_SETTINGS, options);\n  var _palette = options.loopPalette ? loopPalette(options.palette) : options.palette;\n\n  //deafult to black unless we managed to rule this pixel out\n  let color = options.mandelbrotColor;\n\n  if (sample.escaped) {\n    //TODO: explicate the math hereâ€“  it's non-trivial\n    let log_zn = Math.log(sample.orbitDistance) / 2;\n    let nu = Math.log(log_zn / Math.log(2)) / Math.log(2);\n    let fraction = sample.iterations + 1 - nu;\n\n    let color1 = _palette[Math.floor(fraction) % _palette.length];\n    let color2 = _palette[(Math.floor(fraction) + 1) % _palette.length];\n\n    color = _interpolateColor(color1, color2, fraction % 1);\n  }\n  return color;\n}\n\n\nexport default {\n  'default': _escapeTime,\n  'escape-time': _escapeTime,\n  'continuous-coloring': _continuousColoring\n};\n"],"mappings":"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"}